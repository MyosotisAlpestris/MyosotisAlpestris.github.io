{{ if .Site.Params.enableGitalk }}
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const gitalk = new Gitalk({
      clientID: '{{ .site.params.gitalk.clientID }}',  
      clientSecret: '{{ .site.params.gitalk.clientSecret }}',
      repo: '{{ .site.params.gitalk.repo }}',
      owner: '{{ .site.params.gitalk.owner }}',
      admin: ['{{ .site.params.gitalk.owner }}'],
      id: md5(location.pathname).substr(0, 49), // 确保唯一性且符合 GitHub Issue 限制
      distractionFreeMode: false
    });

    (function() {
      if (["localhost", "127.0.0.1"].includes(window.location.hostname)) {
        console.warn("Gitalk is disabled in local preview mode.");
      } else {
        gitalk.render('gitalk-container');
      }
    })();
  });
</script>
{{ end }}

